{"version":3,"file":"preview.js","names":["previewStore","state","nodePageCreatedCallbacks","nodeIdsToCreatedPages","pagePathToNodeDependencyId","reducers","unSubscribeToPagesCreatedFromNodeById","nodeId","subscribeToPagesCreatedFromNodeById","sendPreviewStatus","clearPreviewCallbacks","saveNodePageState","page","path"],"sources":["../../src/models/preview.ts"],"sourcesContent":["// `node` here is a Gatsby node\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport type OnPageCreatedCallback = (node: any) => Promise<void>\n\nexport interface IStoredPage {\n  path: string\n  updatedAt: number\n}\n\nexport interface IPreviewState {\n  nodePageCreatedCallbacks: {\n    [nodeId: string]: OnPageCreatedCallback\n  }\n  nodeIdsToCreatedPages: {\n    [nodeId: string]: {\n      page: IStoredPage\n    }\n  }\n  pagePathToNodeDependencyId: {\n    [pageId: string]: {\n      nodeId: string\n    }\n  }\n}\n\nexport interface IPreviewReducers {\n  subscribeToPagesCreatedFromNodeById: (\n    state: IPreviewState,\n    payload: {\n      nodeId: string\n      sendPreviewStatus: OnPageCreatedCallback\n      modified: string\n    }\n  ) => IPreviewState\n  unSubscribeToPagesCreatedFromNodeById: (\n    state: IPreviewState,\n    payload: {\n      nodeId: string\n    }\n  ) => IPreviewState\n  clearPreviewCallbacks: (state: IPreviewState) => IPreviewState\n  saveNodePageState: (\n    state: IPreviewState,\n    payload: {\n      nodeId: string\n      page: IStoredPage\n    }\n  ) => IPreviewState\n}\n\nexport interface IPreviewStore {\n  state: IPreviewState\n  reducers: IPreviewReducers\n}\n\nconst previewStore: IPreviewStore = {\n  state: {\n    nodePageCreatedCallbacks: {},\n    nodeIdsToCreatedPages: {},\n    pagePathToNodeDependencyId: {},\n  },\n\n  reducers: {\n    unSubscribeToPagesCreatedFromNodeById(state, { nodeId }) {\n      if (state.nodePageCreatedCallbacks?.[nodeId]) {\n        delete state.nodePageCreatedCallbacks[nodeId]\n      }\n\n      return state\n    },\n\n    subscribeToPagesCreatedFromNodeById(state, { nodeId, sendPreviewStatus }) {\n      // save the callback for this nodeId\n      // when a page is created from a node that has this id,\n      // the callback will be invoked\n      state.nodePageCreatedCallbacks[nodeId] = sendPreviewStatus\n\n      return state\n    },\n\n    clearPreviewCallbacks(state) {\n      state.nodePageCreatedCallbacks = {}\n\n      return state\n    },\n\n    saveNodePageState(state, { page, nodeId }) {\n      state.nodeIdsToCreatedPages[nodeId] = {\n        page,\n      }\n\n      state.pagePathToNodeDependencyId[page.path] = {\n        nodeId,\n      }\n\n      return state\n    },\n  } as IPreviewReducers,\n}\n\nexport default previewStore\n"],"mappings":";;;;AAAA;AACA;AAsDA,MAAMA,YAA2B,GAAG;EAClCC,KAAK,EAAE;IACLC,wBAAwB,EAAE,EADrB;IAELC,qBAAqB,EAAE,EAFlB;IAGLC,0BAA0B,EAAE;EAHvB,CAD2B;EAOlCC,QAAQ,EAAE;IACRC,qCAAqC,CAACL,KAAD,EAAQ;MAAEM;IAAF,CAAR,EAAoB;MAAA;;MACvD,6BAAIN,KAAK,CAACC,wBAAV,kDAAI,sBAAiCK,MAAjC,CAAJ,EAA8C;QAC5C,OAAON,KAAK,CAACC,wBAAN,CAA+BK,MAA/B,CAAP;MACD;;MAED,OAAON,KAAP;IACD,CAPO;;IASRO,mCAAmC,CAACP,KAAD,EAAQ;MAAEM,MAAF;MAAUE;IAAV,CAAR,EAAuC;MACxE;MACA;MACA;MACAR,KAAK,CAACC,wBAAN,CAA+BK,MAA/B,IAAyCE,iBAAzC;MAEA,OAAOR,KAAP;IACD,CAhBO;;IAkBRS,qBAAqB,CAACT,KAAD,EAAQ;MAC3BA,KAAK,CAACC,wBAAN,GAAiC,EAAjC;MAEA,OAAOD,KAAP;IACD,CAtBO;;IAwBRU,iBAAiB,CAACV,KAAD,EAAQ;MAAEW,IAAF;MAAQL;IAAR,CAAR,EAA0B;MACzCN,KAAK,CAACE,qBAAN,CAA4BI,MAA5B,IAAsC;QACpCK;MADoC,CAAtC;MAIAX,KAAK,CAACG,0BAAN,CAAiCQ,IAAI,CAACC,IAAtC,IAA8C;QAC5CN;MAD4C,CAA9C;MAIA,OAAON,KAAP;IACD;;EAlCO;AAPwB,CAApC;eA6CeD,Y"}