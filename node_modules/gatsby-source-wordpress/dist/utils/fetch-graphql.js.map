{"version":3,"file":"fetch-graphql.js","names":["http","moduleHelpers","getHttp","limit","rateLimit","axios","create","maxRPS","errorIs500ish","e","message","includes","handleErrorOptions","variables","query","pluginOptions","reporter","Object","keys","length","debug","graphql","showQueryVarsOnError","info","formatLogMessage","JSON","stringify","prettier","format","parser","showQueryOnError","error","copyQueryOnError","clipboardy","write","handleErrors","responseJSON","panicOnError","errorContext","data","panic","id","CODES","BadResponse","context","sourceMessage","handleGraphQLErrors","response","errorMap","forceReportCriticalErrors","getPluginOptions","json","errors","onlyReportCriticalErrors","errorWasMapped","from","to","RemoteGraphQLError","errorPath","path","map","field","index","join","endsWith","slice","debugMessage","category","locations","location","line","column","bold","ensureStatementsAreTrue","genericError","url","slackChannelSupportMessage","getLowerRequestConcurrencyOptionMessage","requestConcurrency","previewRequestConcurrency","perPage","store","getState","gatsbyApi","schema","handleFetchErrors","timeout","isFirstRequest","headers","Timeout","useVerboseStyle","console","Error","stack","WordPress500ishError","unauthorized","htaccessCredentials","auth","htaccess","missingCredentials","password","username","Authentication","forbidden","RequestDenied","redirected","WordPressFilters","responseReturnedHtml","requestOptions","urlWithoutTrailingSlash","replace","post","contentType","docsLink","MissingAppendedPath","err","copyHtmlResponseOnError","writeSync","sharedEmptyStringReponseError","emptyStringResponse","log","process","env","NODE_ENV","warn","SelfSignedCert","fetchGraphql","ignoreGraphQLErrors","throwGqlErrors","throwFetchErrors","helpers","pluginOptionsUrl","retry","bail","catch","retries","urlUtil","parse","responsePath","request","undefined","stringifiedErrors"],"sources":["../../src/utils/fetch-graphql.ts"],"sourcesContent":["/* eslint-disable no-useless-escape */\n\nimport { IPluginOptions } from \"~/models/gatsby-api\"\nimport { GatsbyReporter } from \"./gatsby-types\"\nimport prettier from \"prettier\"\nimport clipboardy from \"clipboardy\"\nimport axios, { AxiosRequestConfig, AxiosResponse } from \"axios\"\nimport rateLimit, { RateLimitedAxiosInstance } from \"axios-rate-limit\"\nimport { bold } from \"chalk\"\nimport retry from \"async-retry\"\nimport { formatLogMessage } from \"./format-log-message\"\nimport store from \"~/store\"\nimport { getPluginOptions } from \"./get-gatsby-api\"\nimport urlUtil from \"url\"\nimport { CODES } from \"./report\"\n\nlet http = null\n\n// this is an object so that we can override getHttp in our tests\nexport const moduleHelpers = {\n  getHttp: (limit = 50): RateLimitedAxiosInstance => {\n    if (!http) {\n      http = rateLimit(axios.create(), {\n        maxRPS: limit,\n      })\n    }\n    return http\n  },\n}\n\nconst errorIs500ish = (e: Error): boolean =>\n  e.message.includes(`Request failed with status code 50`) &&\n  (e.message.includes(`502`) ||\n    e.message.includes(`503`) ||\n    e.message.includes(`500`) ||\n    e.message.includes(`504`))\n\ninterface IHandleErrorOptionsInput {\n  variables: IJSON\n  query: string\n  pluginOptions: IPluginOptions\n  reporter: GatsbyReporter\n}\n\nconst handleErrorOptions = async ({\n  variables,\n  query,\n  pluginOptions,\n  reporter,\n}: IHandleErrorOptionsInput): Promise<void> => {\n  if (\n    variables &&\n    Object.keys(variables).length &&\n    pluginOptions.debug.graphql.showQueryVarsOnError\n  ) {\n    reporter.info(\n      formatLogMessage(`GraphQL vars: ${JSON.stringify(variables)}`)\n    )\n  }\n\n  try {\n    query = prettier.format(query, { parser: `graphql` })\n  } catch (e) {\n    // do nothing\n  }\n\n  if (pluginOptions.debug.graphql.showQueryOnError) {\n    reporter.error(formatLogMessage(`GraphQL query: ${query}`))\n  }\n\n  if (pluginOptions.debug.graphql.copyQueryOnError) {\n    try {\n      await clipboardy.write(query)\n    } catch (e) {\n      // do nothing\n    }\n  }\n}\n\ninterface IHandleErrors {\n  variables: IJSON\n  query: string\n  pluginOptions: IPluginOptions\n  reporter: GatsbyReporter\n  responseJSON: IJSON\n  panicOnError: boolean\n  errorContext: string\n}\n\nconst handleErrors = async ({\n  variables,\n  query,\n  pluginOptions,\n  reporter,\n  responseJSON,\n  panicOnError,\n  errorContext,\n}: IHandleErrors): Promise<void> => {\n  await handleErrorOptions({\n    variables,\n    query,\n    pluginOptions,\n    reporter,\n  })\n\n  if (!responseJSON) {\n    return\n  }\n\n  if (\n    !responseJSON.data ||\n    panicOnError ||\n    pluginOptions.debug.graphql.panicOnError\n  ) {\n    reporter.panic({\n      id: CODES.BadResponse,\n      context: {\n        sourceMessage: formatLogMessage(\n          errorContext || `Encountered errors. See above for details.`\n        ),\n      },\n    })\n  }\n}\n\ninterface IHandleGraphQLErrorsInput {\n  query: string\n  variables: IJSON\n  response: AxiosResponse\n  errorMap: IErrorMap\n  panicOnError: boolean\n  reporter: GatsbyReporter\n  errorContext: string\n  forceReportCriticalErrors: boolean\n}\n\nconst handleGraphQLErrors = async ({\n  query,\n  variables,\n  response,\n  errorMap,\n  panicOnError,\n  reporter,\n  errorContext,\n  forceReportCriticalErrors = false,\n}: IHandleGraphQLErrorsInput): Promise<void> => {\n  const pluginOptions = getPluginOptions()\n\n  const json = response?.data\n  const { errors } = json || {}\n\n  if (!errors) {\n    return\n  }\n\n  // if we have json data, the error wasn't critical.\n  if (\n    json &&\n    json.data &&\n    pluginOptions.debug.graphql.onlyReportCriticalErrors &&\n    // only return if we're not force disabling this.\n    // this is used when we make GraphQL requests intentionally rather than programmatically\n    // for ex during the Preview process\n    !forceReportCriticalErrors\n  ) {\n    return\n  }\n\n  for (const error of errors) {\n    const errorWasMapped =\n      errorMap &&\n      errorMap.from &&\n      errorMap.to &&\n      error.message === errorMap.from\n\n    if (errorWasMapped && panicOnError) {\n      reporter.panic({\n        id: CODES.RemoteGraphQLError,\n        context: {\n          sourceMessage: formatLogMessage(errorMap.to),\n        },\n      })\n    } else if (errorWasMapped) {\n      reporter.error({\n        id: CODES.RemoteGraphQLError,\n        context: {\n          sourceMessage: formatLogMessage(errorMap.to),\n        },\n      })\n    }\n\n    // convert the error path array into a string like \"mediaItems.nodes[55].mediaDetails.meta.focalLength\"\n    let errorPath = error?.path\n      ?.map((field, index) => {\n        // if this is a number it's the index of a node\n        if (typeof field === `number`) {\n          return `[${field}].`\n        } else if (\n          // otherwise if the next field isn't a number\n          typeof error.path[index + 1] !== `number`\n        ) {\n          // add dot notation\n          return `${field}.`\n        }\n\n        // or just return the field\n        return field\n      })\n      ?.join(``)\n\n    if (errorPath?.endsWith(`.`)) {\n      // trim \".\" off the end of the errorPath\n      errorPath = errorPath.slice(0, -1)\n    }\n\n    if (error.debugMessage) {\n      reporter.error(\n        formatLogMessage(\n          `Error category: ${error.category} \\n\\nError: \\n  ${error.message} \\n\\n Debug message: \\n  ${error.debugMessage} \\n\\n Error path: ${errorPath}`\n        )\n      )\n    } else {\n      reporter.error(\n        formatLogMessage(\n          `(${error.category}) ${\n            error?.locations?.length\n              ? error.locations\n                  .map(\n                    location =>\n                      `location: line ${location.line}, column: ${location.column}`\n                  )\n                  ?.join(`. `)\n              : ``\n          } \\n\\t ${\n            error.message\n          }  \\n\\n Error path: ${errorPath} \\n\\n If you haven't already, try adding ${bold(\n            `define( 'GRAPHQL_DEBUG', true );`\n          )} to your wp-config.php for more detailed error messages.`\n        )\n      )\n    }\n  }\n\n  await handleErrors({\n    responseJSON: json,\n    variables,\n    pluginOptions,\n    reporter,\n    query,\n    panicOnError,\n    errorContext,\n  })\n}\n\nconst ensureStatementsAreTrue = `${bold(\n  `Please ensure the following statements are true`\n)} \\n  - your WordPress URL is correct in gatsby-config.js\\n  - your server is responding to requests \\n  - WPGraphQL and WPGatsby are installed and active in your WordPress backend\\n  - Your WordPress debug.log does not contain critical errors`\n\n// @todo add a link to docs page for debugging\nconst genericError = ({ url }: { url: string }): string =>\n  `GraphQL request to ${bold(url)} failed.\\n\\n${ensureStatementsAreTrue}`\n\nconst slackChannelSupportMessage = `If you're still having issues, please visit https://www.wpgraphql.com/community-and-support/\\nand follow the link to join the WPGraphQL Slack.\\nThere are a lot of folks there in the #gatsby channel who are happy to help with debugging.`\n\nconst getLowerRequestConcurrencyOptionMessage = (): string => {\n  const { requestConcurrency, previewRequestConcurrency, perPage } =\n    store.getState().gatsbyApi.pluginOptions.schema\n\n  return `Try reducing the ${bold(\n    `requestConcurrency`\n  )} for content updates or the ${bold(\n    `previewRequestConcurrency`\n  )} for previews, and/or reducing the schema.perPage option:\n\n{\n  resolve: 'gatsby-source-wordpress',\n  options: {\n    schema: {\n      perPage: 20, // currently set to ${perPage}\n      requestConcurrency: 5, // currently set to ${requestConcurrency}\n      previewRequestConcurrency: 2, // currently set to ${previewRequestConcurrency}\n    }\n  },\n}`\n}\n\ninterface IHandleFetchErrors {\n  e: Error\n  reporter: GatsbyReporter\n  url: string\n  timeout: number\n  pluginOptions: IPluginOptions\n  query: string\n  response: AxiosResponse\n  errorContext: string\n  variables?: IJSON\n  isFirstRequest?: boolean\n  headers?: IFetchGraphQLHeaders\n}\n\nconst handleFetchErrors = async ({\n  e,\n  reporter,\n  url,\n  timeout,\n  variables,\n  pluginOptions,\n  query,\n  response,\n  errorContext,\n  isFirstRequest,\n  headers,\n}: IHandleFetchErrors): Promise<void> => {\n  await handleErrors({\n    panicOnError: false,\n    reporter,\n    variables,\n    pluginOptions,\n    query,\n    errorContext,\n    responseJSON: null,\n  })\n\n  if (e.message.includes(`timeout of ${timeout}ms exceeded`)) {\n    reporter.error(e.message)\n    reporter.panic({\n      id: CODES.Timeout,\n      context: {\n        sourceMessage: formatLogMessage(\n          `It took too long for ${url} to respond (longer than ${\n            timeout / 1000\n          } seconds).\\n\\nEither your URL is wrong, you need to increase server resources, or you need to decrease the amount of resources each request takes.\\n\\nYou can configure how much resources each request takes by lowering your \\`options.schema.perPage\\` value from the default of 100 nodes per request.\\nAlternatively you can increase the request timeout by setting a value in milliseconds to \\`options.schema.timeout\\`, the current setting is ${timeout}.\\n\\n${genericError(\n            { url }\n          )}`,\n          { useVerboseStyle: true }\n        ),\n      },\n    })\n    return\n  }\n\n  if (errorIs500ish(e) && !e.message.includes(`500`)) {\n    if (`message` in e) {\n      console.error(formatLogMessage(new Error(e.message).stack))\n    }\n\n    reporter.panic({\n      id: CODES.WordPress500ishError,\n      context: {\n        sourceMessage: formatLogMessage(\n          `Your WordPress server at ${bold(url)} appears to be overloaded.\n\n${getLowerRequestConcurrencyOptionMessage()}`,\n          { useVerboseStyle: true }\n        ),\n      },\n    })\n\n    return\n  } else if (e.message.includes(`Request failed with status code 500`)) {\n    reporter.panic({\n      id: CODES.WordPress500ishError,\n      context: {\n        sourceMessage: formatLogMessage(\n          `${e.message}\n\nYour WordPress server is either overloaded or encountered a PHP error.\n${errorContext ? `\\n${errorContext}\\n` : ``}\nEnable WordPress debugging by adding the following to your wp-config.php file:\n\ndefine(\"WP\\_DEBUG\", true);\ndefine(\"WP\\_DEBUG\\_LOG\", true);\ndefine(\"GRAPHQL\\_DEBUG\", true);\n\n(See https://wordpress.org/support/article/debugging-in-wordpress/ for more info)\n\nThen run another build before checking your WordPress instance's debug.log file for errors.\n\nIf you don't see any errors in debug.log:\n\n${getLowerRequestConcurrencyOptionMessage()}`,\n          { useVerboseStyle: true }\n        ),\n      },\n    })\n\n    return\n  }\n\n  const unauthorized = e.message.includes(`Request failed with status code 401`)\n\n  const htaccessCredentials = pluginOptions.auth.htaccess\n\n  const missingCredentials =\n    !htaccessCredentials.password || !htaccessCredentials.username\n\n  if (unauthorized && !missingCredentials) {\n    reporter.panic({\n      id: CODES.Authentication,\n      context: {\n        sourceMessage: formatLogMessage(\n          `Request failed with status code 401.\\n\\nThe HTTP Basic Auth credentials you've provided in plugin options were rejected.\\nDouble check that your credentials are correct.\n         \\n${genericError({ url })}`,\n          { useVerboseStyle: true }\n        ),\n      },\n    })\n\n    return\n  } else if (unauthorized) {\n    reporter.panic({\n      id: CODES.Authentication,\n      context: {\n        sourceMessage: formatLogMessage(\n          `Request failed with status code 401.\\n\\n Your WordPress instance may be protected with HTTP Basic authentication.\\n If it is you will need to add the following to your plugin options:\n\n        {\n          resolve: \\`gatsby-source-wordpress\\`,\n          options: {\n            auth: {\n              htaccess: {\n                username: process.env.HTTPBASICAUTH_USERNAME,\n                password: process.env.HTTPBASICAUTH_PASSWORD,\n              }\n            }\n          }\n        }\n         \\n${genericError({ url })}`,\n          { useVerboseStyle: true }\n        ),\n      },\n    })\n\n    return\n  }\n\n  const forbidden = e.message.includes(`Request failed with status code 403`)\n\n  if (forbidden) {\n    reporter.panic({\n      id: CODES.RequestDenied,\n      context: {\n        sourceMessage: formatLogMessage(\n          `${e.message}\\n\\nThe GraphQL request was forbidden.\\nIf you are using a security plugin like WordFence or a server firewall you may need to add your IP address to the allow list or adjust your firewall settings for your GraphQL endpoint.\\n\\n${errorContext}`\n        ),\n      },\n    })\n\n    return\n  }\n\n  const redirected = e.message.includes(`GraphQL request was redirected`)\n\n  if (redirected) {\n    await handleErrorOptions({ variables, query, pluginOptions, reporter })\n    reporter.panic({\n      id: CODES.WordPressFilters,\n      context: {\n        sourceMessage: formatLogMessage(\n          `${e.message}\\n\\n${errorContext}\\n\\nThis can happen due to custom code or redirection plugins which redirect the request when a post is accessed.\\nThis redirection code will need to be patched to not run during GraphQL requests.\\n\\nThat can be achieved by adding something like the following to your WP PHP code:\\n\nif ( defined( 'GRAPHQL_REQUEST' ) && true === GRAPHQL_REQUEST ) {\n  return examplePreventRedirect();\n}\n\n${slackChannelSupportMessage}`\n        ),\n      },\n    })\n\n    return\n  }\n\n  const responseReturnedHtml =\n    !!response?.headers[`content-type`].includes(`text/html;`)\n  const limit = pluginOptions?.schema?.requestConcurrency\n\n  if (responseReturnedHtml && isFirstRequest) {\n    const requestOptions: AxiosRequestConfig = {\n      timeout,\n      headers,\n    }\n\n    if (!missingCredentials) {\n      requestOptions.auth = htaccessCredentials\n    }\n\n    try {\n      const urlWithoutTrailingSlash = url.replace(/\\/$/, ``)\n\n      const response: AxiosResponse = await moduleHelpers\n        .getHttp(limit)\n        .post(\n          `${urlWithoutTrailingSlash}/graphql`,\n          { query, variables },\n          requestOptions\n        )\n\n      const contentType = response?.headers[`content-type`]\n\n      if (contentType?.includes(`application/json;`)) {\n        const docsLink = `https://github.com/gatsbyjs/gatsby/blob/master/packages/gatsby-source-wordpress/docs/plugin-options.md#url-string`\n\n        // if adding `/graphql` works, panic with a useful message\n        reporter.panic({\n          id: CODES.MissingAppendedPath,\n          context: {\n            sourceMessage: formatLogMessage(\n              `${\n                errorContext ? `${errorContext}` : ``\n              }\\n\\nThe supplied url ${bold(\n                urlWithoutTrailingSlash\n              )} is invalid,\\nhowever ${bold(\n                urlWithoutTrailingSlash + `/graphql`\n              )} works!\\n\\nFor this plugin to consume the wp-graphql schema, you'll need to specify the full URL\\n(${bold(\n                urlWithoutTrailingSlash + `/graphql`\n              )}) in your gatsby-config.\\n\\nYou can learn more about configuring the source plugin URL here:\\n${docsLink}\\n\\n`\n            ),\n          },\n        })\n\n        return\n      }\n    } catch (err) {\n      // elsewise, continue to handle HTML response as normal\n    }\n\n    const copyHtmlResponseOnError =\n      pluginOptions?.debug?.graphql?.copyHtmlResponseOnError\n\n    if (copyHtmlResponseOnError) {\n      try {\n        if (`writeSync` in clipboardy) {\n          clipboardy.writeSync(response.data)\n        }\n      } catch (e) {\n        reporter.error(\n          formatLogMessage(\n            `Unable to copy html response on error.\\n\\n${e.message ?? ``}`\n          )\n        )\n      }\n    }\n\n    reporter.panic({\n      id: CODES.BadResponse,\n      context: {\n        sourceMessage: formatLogMessage(\n          `${errorContext || ``}\\n\\n${\n            e.message\n          } \\n\\nReceived HTML as a response. Are you sure ${url} is the correct URL and WPGraphQL is active?\\n\\nIf you're sure WPGraphQL is active, visit that URL in a browser - if it redirects to the correct URL,\\nor you've entered the wrong URL in settings,\\nyou might receive this error.\\nVisit that URL in your browser and if it looks good copy/paste it from your URL bar to your gatsby-config.js.\\n\\n${ensureStatementsAreTrue}${\n            copyHtmlResponseOnError\n              ? `\\n\\nCopied HTML response to your clipboard.`\n              : `\\n\\n${bold(\n                  `Further debugging`\n                )}\\nIf you still receive this error after following the steps above, this may be a problem with your WordPress instance.\\nA plugin or theme may be adding additional output for some posts or pages.\\nAdd the following plugin option to copy the html response to your clipboard for debugging.\\nYou can paste the response into an html file to see what's being returned.\\n\n{\n  resolve: \"gatsby-source-wordpress\",\n  options: {\n    debug: {\n      graphql: {\n        copyHtmlResponseOnError: true\n      }\n    }\n  }\n}`\n          }\n        `,\n          {\n            useVerboseStyle: true,\n          }\n        ),\n      },\n    })\n\n    return\n  } else if (responseReturnedHtml && !isFirstRequest) {\n    reporter.panic({\n      id: CODES.WordPressFilters,\n      context: {\n        sourceMessage: formatLogMessage(\n          `${errorContext}\\n\\n${e.message}\\n\\nEither WPGraphQL is not active or there are some WordPress PHP filters in your site which are adding additional output to the GraphQL response.\\nThese may have been added via custom code or via a plugin.\\n\\nYou will need to debug this and remove these filters during GraphQL requests using something like the following:\n\nif ( defined( 'GRAPHQL_REQUEST' ) && true === GRAPHQL_REQUEST ) {\n  return;\n}\\n\\nYou can use the gatsby-source-wordpress debug options to determine which GraphQL request is causing this error.\\nhttps://github.com/gatsbyjs/gatsby/blob/master/packages/gatsby-source-wordpress/docs/plugin-options.md#debuggraphql-object`\n        ),\n      },\n    })\n\n    return\n  }\n\n  const sharedEmptyStringReponseError = `\\n\\nAn empty string was returned instead of a response when making a GraphQL request.\\nThis may indicate that you have a WordPress filter running which is causing WPGraphQL\\nto return an empty string instead of a response.\\nPlease open an issue with a reproduction at\\nhttps://github.com/gatsbyjs/gatsby/issues/new\\nfor more help\\n\\n${errorContext}\\n`\n\n  const emptyStringResponse =\n    e.message === `GraphQL request returned an empty string.`\n\n  if (emptyStringResponse) {\n    reporter.log(``)\n    if (process.env.NODE_ENV === `development`) {\n      reporter.warn(formatLogMessage(sharedEmptyStringReponseError))\n    } else {\n      reporter.panic({\n        id: CODES.BadResponse,\n        context: {\n          sourceMessage: formatLogMessage(sharedEmptyStringReponseError),\n        },\n      })\n\n      return\n    }\n\n    return\n  }\n\n  if (e.message.includes(`self signed certificate`)) {\n    reporter.panic({\n      id: CODES.SelfSignedCert,\n      context: {\n        sourceMessage: formatLogMessage(\n          `${e.message}\\n\\nSee the docs for more information:\\nhttps://github.com/gatsbyjs/gatsby/blob/master/packages/gatsby-source-wordpress/docs/tutorials/using-self-signed-certificates.md`\n        ),\n      },\n    })\n\n    return\n  }\n\n  // generic error if none of the above exit the process\n  reporter.panic({\n    id: CODES.BadResponse,\n    context: {\n      sourceMessage: formatLogMessage(\n        `${e.stack} ${\n          errorContext ? `\\n\\n` + errorContext : ``\n        }\\n\\n${genericError({ url })}`,\n        {\n          useVerboseStyle: true,\n        }\n      ),\n    },\n  })\n\n  return\n}\n\nexport interface IJSON {\n  // these will always be different depending on where this is used\n  // we need this for GraphQL results and the node filter api\n  // which can be used in any way by users\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  [key: string]: any\n}\n\ninterface IFetchGraphQLHeaders {\n  WPGatsbyPreview?: string\n  Authorization?: string\n  WPGatsbyPreviewUser?: number\n}\n\ninterface IErrorMap {\n  from: string\n  to: string\n}\n\ninterface IFetchGraphQLInput {\n  url?: string\n  query: string\n  errorContext?: string\n  ignoreGraphQLErrors?: boolean\n  panicOnError?: boolean\n  throwGqlErrors?: boolean\n  throwFetchErrors?: boolean\n  isFirstRequest?: boolean\n  forceReportCriticalErrors?: boolean\n  errorMap?: IErrorMap\n  variables?: IJSON\n  headers?: IFetchGraphQLHeaders\n}\n\ntype IGraphQLDataResponse = IJSON\n\nconst fetchGraphql = async ({\n  query,\n  errorMap,\n  ignoreGraphQLErrors = false,\n  panicOnError = false,\n  throwGqlErrors = false,\n  throwFetchErrors = false,\n  url,\n  variables = {},\n  headers = {},\n  errorContext = null,\n  isFirstRequest = false,\n  forceReportCriticalErrors = false,\n}: IFetchGraphQLInput): Promise<IGraphQLDataResponse> => {\n  const { helpers, pluginOptions } = store.getState().gatsbyApi\n  const limit = pluginOptions?.schema?.requestConcurrency\n\n  const { url: pluginOptionsUrl } = pluginOptions\n  let { reporter } = helpers\n\n  if (!reporter || typeof reporter === `undefined`) {\n    reporter = {\n      panic: (message: { id: string; context: { sourceMessage: string } }) => {\n        throw new Error(message?.context?.sourceMessage)\n      },\n      error: console.error as GatsbyReporter[\"error\"],\n    } as GatsbyReporter\n  }\n\n  if (!url) {\n    url = pluginOptionsUrl\n  }\n\n  const timeout = pluginOptions.schema.timeout\n\n  const htaccessCredentials = pluginOptions.auth.htaccess\n\n  const missingCredentials =\n    !htaccessCredentials.password || !htaccessCredentials.username\n\n  let response: AxiosResponse\n\n  try {\n    const requestOptions: AxiosRequestConfig = {\n      timeout,\n      headers,\n    }\n\n    if (!missingCredentials) {\n      requestOptions.auth = htaccessCredentials\n    }\n\n    response = await retry(\n      (bail: (e: Error) => void) =>\n        moduleHelpers\n          .getHttp(limit)\n          .post(url, { query, variables }, requestOptions)\n          .catch(e => {\n            if (!errorIs500ish(e)) {\n              // for any error that is not a 50x error, we bail, meaning we stop retrying. error will be thrown one level higher\n              bail(e)\n\n              return null\n            } else {\n              // otherwise throwing the error will cause the retry to happen again\n              throw e\n            }\n          }),\n      { retries: 5 }\n    )\n\n    if (response.data === ``) {\n      throw new Error(`GraphQL request returned an empty string.`)\n    }\n\n    const { path }: { path: string } = urlUtil.parse(url)\n\n    const responsePath = response.request.path\n\n    if (\n      path !== responsePath &&\n      responsePath !== undefined &&\n      responsePath !== url\n    ) {\n      throw new Error(`GraphQL request was redirected to ${responsePath}`)\n    }\n\n    const contentType: string = response.headers[`content-type`]\n\n    if (!contentType.includes(`application/json;`)) {\n      throw new Error(`Unable to connect to WPGraphQL.`)\n    }\n  } catch (e) {\n    if (throwFetchErrors) {\n      throw e\n    }\n\n    await handleFetchErrors({\n      e,\n      reporter,\n      url,\n      timeout,\n      variables,\n      pluginOptions,\n      query,\n      response,\n      errorContext,\n      isFirstRequest,\n    })\n  }\n\n  if (throwGqlErrors && response.data.errors) {\n    const stringifiedErrors: string = response.data.errors\n      .map((error: { message: string }) => error.message)\n      .join(`\\n\\n`)\n\n    throw new Error(stringifiedErrors)\n  }\n\n  if (!ignoreGraphQLErrors) {\n    await handleGraphQLErrors({\n      query,\n      variables,\n      response,\n      errorMap,\n      panicOnError,\n      reporter,\n      errorContext,\n      forceReportCriticalErrors,\n    })\n  }\n\n  return response?.data\n}\n\nexport default fetchGraphql\n"],"mappings":"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"}